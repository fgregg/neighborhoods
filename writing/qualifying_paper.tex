\documentclass[12pt,letter]{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\title{Learning Who Your Neighbors Are}
\date{}
\author{}
\usepackage{amsmath}
\usepackage{url}
\usepackage{tikz}
\usepackage{adjustbox}
\usepackage{natbib}
\usepackage{endnotes}
\usepackage{setspace}
%\usepackage{endfloat}
\doublespacing

\let\footnote=\endnote
\let\cite=\citep

\usetikzlibrary{arrows}
\usetikzlibrary{bayesnet}

\DeclareMathOperator*{\argmin}{\arg\!\min}
\DeclareMathOperator*{\argmax}{\arg\!\max}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}

\begin{document}
\maketitle







\section*{Introduction}
City residents face a variety of problems that require coordinating
with neighbors: informal social control of youth, maintaining or
increasing property values, keeping the sidewalk free of ice 
in winter, electing officials, or getting permits for a block party. 

Residents coordinate their actions through personal contacts with
neighbors, formal organizations, or shared perceptions and beliefs
about the neighborhood \cite{needed}. These different bases for action imply
different sets of relevant neighbors. For keeping an eye out for
truant school children, the relevant neighbors are mainly other
residents on the block, known by and to the resident. For electing a
city councilor, the relevant neighbors are all voters in an arbitrary
political district. For calculating whether to buy a home, the
relevant neighbors are those whose recent actions and fate in the
market is especially informative about the economic fortunes of an
area.

In researching how neighbors develop capacity to act collectively,
scholars have focused on the first two: investigating how residents
come to have personal relations with their neighbors and the ways that
local and city-wide organizations can solve local coordination
problems.

This is not because researchers think that beliefs and perceptions are
unimportant. The key results in the neighborhood effects literature
are result about beliefs. Resident's beliefs about neighbors, as
reported in survey research, appear to influence a variety of measures
of social order. From the place making literature, we know that local
activists and developers also believe that the fate of an area can
depend upon beliefs about what the area is or will be.

However, we know very little about a.) how residents come to perceive some
common region of the city as their neighborhood, and b.) how they form
beliefs about this area. In large part, this is because we have not
had any means to systematically and reliably identify the parts of a
city that residents will tend to see as their neighborhood. It's hard
to study how a thing emerges and changes if we can't locate the thing.

A number of researchers have attempted to identify perceived
neighborhoods by surveying city residents, typically by asking
residents to draw maps of their neighborhood. These studies
persistently find that residents draw very idiosyncratic maps, often
with little overlap.\cite{hunter_symbolic_1974, campbell_subjective_2009}.

A resident's ability to draw a map of their neighborhood is influenced
where they live, their daily rounds of movement, how long they have
lived in the area, their life stage, their overall level of mobility,
and a raft of other personalistic factors\cite{needed}. Yet, even with great
individual level variation, there can still be definite districts of
a city wherein residents will all tend to perceive that area as their
neighborhood.

However, in order to observe these average perceived neighborhoods, we
need enough data to wash out the personalistic variation of individual
residents. Historically, it has not been practical to collect these
data at the volume and spatial resolution necessary.

In this paper, I discuss a novel Internet source for data on
neighborhood perception, demonstrate that this data coheres together,
and provide evidence that these differences in perception line up with
differences in the physical and social organization of different
areas. Further, I show how we can use these data to predict what areas
of a city are likely to be seen as distinct areas by residents even
when we don't have data on those resident's perceptions.

\section*{Neighborhood Claims}
Craigslist is the largest classified listing service. It
has about 60 million visitors each month from the United States. The
service is organized into more than 700 city specific sites. On a city
specific site, like \url{http://chicago.craigslist.org}, the
classified listings are organized into categories like ``Housing'' and 
subcategories like ``Sublets/Temporary.'' 

It is free to read the classified ads and free to post ads except for
a few subcategories. It is free to post in all the ``Housing''
categories except for brokered apartment rentals in New York City. 

Both private individuals and real estate companies use Craigslist to
advertise housing listings. However, the listings in the categories
for roommates, shared housing, sublets, are mainly made by
individuals. The listings for apartments are mainly made by landlords
both large and small. 

When an advertiser posts a housing listing on Craigslist they have the
option of putting in an address of the listing or a nearby street
intersection. If the advertiser puts in the geographic information,
she will be shown a map with a pin over the listing's location. If the
pin is not in the correct place, the advertiser can move the pin as
necessary. The advertiser can also put a pin in the desired location
without entering in address or street intersection information. When
the listing is published, the geographic coordinates of the posting
are embedded in the posting's web page.

In addition, to location of the listing, the advertiser also has the
option of filling out a field entitled ``Specific location.'' The
advertiser can put whatever text she wants to in this field, but
typically advertisers put in the name of a neighborhood. This
information is also embedded in the published listing.

If a housing listing has a neighborhood name in the ``Specific
location'' and the geographic coordinates of the listing location, the
listing represents a claim that a particular point in the city is part
of a neighborhood.

I have written a computer program that checks for and downloads, every
night, listings in the ``apts/housing'', ``rooms/shared'', and
``sublets/temporary'' subcategories for the following cities:

New York, Los Angeles, Houston, Philadelphia, Phoenix, San Antonio,
San Diego, Dallas, Jacksonville, Indianapolis, San Francisco, Austin,
Columbus, Charlotte, Detroit, El Paso, Memphis, Baltimore, Boston,
Seattle, Washington D.C., Nashville, Denver, Louisville, Milwaukee,
Portland, Las Vegas, Oklahoma City, Albuquerque, Tucson, Fresno,
Sacramento, Kansas City, Atlanta, Colorado Springs, Omaha, Raleigh,
Miami, Cleveland, Tulsa, Minneapolis, Wichita, Knoxville, and Asheville.

Another computer program parses the downloaded web page (a HTML
document) and extracts the geographic information and the contents of
the ``Specific location'' field. If the geographic coordinates are
missing, but address or street intersection information is available,
the program attempt to lookup the geographic coordinates associated with
this information using a geocoding service \cite{needed}. 

* information on how many posts
* how many claims


\subsection*{Data}



Using these claims about specific locations, we can estimate the areas
that advertisers will claim to be a different neighborhoods. This will
be a two step process. First, we will use claims about discrete
locations to estimate how likely we are to see a particular
neighborhood claim over continuous, geographic space. Second,
comparing these likelihoods, we will identify the areas where a
particular neighborhood is more likely to be claimed than any other
alternative. These regions, where the plurality of neighborhood claims
favor one neighborhood, will be a measure of average perceived
neighborhoods.

For a particular neighborhood name, the probability that the name will
appear in a listings's ``Specific location'' field can vary depending
upon the location the listing is about. In other words, the claims for
a particular neighborhood name has a probability distribution over
geographic space. 

Given a particular neighborhood claim distribution, we can think of
our observed neighborhood claims as random draws from this
distribution. This means that we can estimate this unobserved
distribution over space by looking at the empirical concentration of
observed neighborhood claims. 

There are many ways to estimate a distribution over space from
observed point data. For one dimensional space, the classic histogram
is the most familiar method. We'll use a simple method called Kernel
Density Estimation (KDE). It behaves much like smoothed histogram
(Figure 1).

With KDE, we replace every observed point with a two-dimensional
normal distribution. For each location in space, there is some
probability density associated with every observation. For this
location, if we sum up all these densities, we arrive at an estimate
of the density of the distribution of neighborhood claims over space
at this location. To estimate the entire distribution of neighborhood
claims, we repeat this summation for every single point in space.

\begin{figure}
\includegraphics[width=\textwidth]{Comparison_of_1D_histogram_and_KDE.png}
\caption{Histogram and KDE in One-dimensional Space \cite{wikipedia}}
\end{figure}

\section*{Are claimed neighborhoods coherent?}

Using KDE, we estimate the geographic probability distribution for
every neighborhood name we observe. With this in hand, we can estimate
the probability of seeing a neighborhood claim at any location in the
city for any neighborhood: $\hat{\Pr}(\text{Location}_j \mid
\text{Hood}_i)$

Next, we transform these probabilities into the probabilities of
observing a particular neighborhood claim given a location. Since
distributions of different neighborhood claims will overlap, this will
be a multinomial probability conditional on location.

\begin{equation}
  \Pr(\text{Hood}_i \mid \text{Location}_j) = 
  \frac{\Pr(\text{Hood}_i)\Pr(\text{Location}_j \mid \text{Hood}_i)}
       {\sum_k^N \Pr(\text{Hood}_k)\Pr(\text{Location}_j \mid \text{Hood}_k)}
\end{equation}

\noindent
approximated by

\begin{equation}
  \hat{\Pr}(\text{Hood}_i \mid \text{Location}_j) = 
  \frac{n_i\hat{\Pr}(\text{Location}_j \mid \text{Hood}_i)}
       {\sum_k^N n_k\hat{\Pr}(\text{Location}_j \mid \text{Hood}_k)}
\end{equation}

\noindent 
Where $n_i$ is the number of observations of neighborhood name $i$.

In Figure \ref{fig:prob}, we map the estimated probabilities for
neighborhood claims on the North Side of Chicago. Each color
represents a different neighborhood claim distribution. The dark lines
between mark the where the most probable neighborhood claim switches
from one neighborhood to another.

\begin{figure}
  \centering
  \includegraphics{probability.pdf}
  \caption{Estimated probabilities for neighborhood claims}
\label{fig:prob}
\end{figure}

Visually, we can notice that each 'neighborhood' is contiguous. There
is no neighborhood name that dominates in two separate, disconnected
areas. There are definite districts of the city wherein Craigslist
advertisers tend to claim that area is a neighborhood.

\section*{Spatial and Social Organization}

Moreover, the distribution of claims of Craiglist advertisers likely
generalizes to the distribution of perceptions of residents. The
spatial organization of `claimed neighborhoods' is associated with the
physical barriers and sociological similarities and differences that
urban sociologists have long associated with neighborhood
formation. We'll make this case first visually and
impressionalistically, and then formally and mathematically.

In the Figure \ref{fig:prob}, the map also shows the large parks, the
north branch of the Chicago river and railroad embankments (dashed
line). Neighborhoods are generally separated by these large physical
features. In light gray, we have also plotted the borders of Community
Areas--areas defined by Ernest Burgess in the 1920s, which he believed
had and would continue to have distinct social histories. The `claimed
neighborhoods' toe the lines of Burgess's areas.

In order make these associations mathematically precise, we need a
means of associating the spatial organization of a claimed
neighborhood with the spatial organization of sociological factors and
the locations of physical borders. 

As a first step, we could split the city up into a large number of
small areas, say city blocks. Then, for each block, we can attempt to
predict the dominant neighborhood claim. The prediction for a
particular block should depend upon what we predict for the
neighboring blocks. This is a problem of multinomial regression with
spatial autocorrelation. 

This type of problem is not tractable using classic techniques of
maximum likelihood or MCMC methods. The inter-block coupling of
discrete variables requires that we calculate terms for ever possible
configuration of assignments of neighborhood claims to blocks. With
just a few blocks and possible neighborhood claims, the combinatorial
explosion makes this computationally unfeasible.

However, computer scientists have developed techniques for just this
kind of problem, called structured Support Vector Machines. In brief,
this technique puts together four ideas. First, a formalism that can
represent a probability distribution over coupled discrete random
variables as an undirected graph. Second, the result that the Maximum
a priori configuration of that distribution is equivalent to a special
partition of the graph called max flow/min cut. Third, a method of
finding the max flow/min cut partition of a graph in polynomial
time. Fourth, and finally, an optimization routine that works with
very limited exploration of the space of possibilties. Let us now
describe this method bit by bit.

\input{theory_and_math.tex}




For context, this 

Finally, at the center of every census block, we will calculate the most
probable neighborhood assignment and assign that most likely
neighborhood to that block. (Figure \ref{fig:training}).

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/plotTraining} 

}



\end{knitrout}

\caption{Training Data}
\label{fig:training}
\end{figure}


I would like to treat this measure as a kind of `averaged neighborhood
perception.' Of course, it is at best a biased measure of that
perception. There are enormous selection effect. Most of the
Craigslist listings come from the part of Chicago that have higher
fractions of young adults. Moreover, we are only considering listings
for roommates, sublets, and apartments. Portions of the city that are
dominated by owner occupants are underrepresented, because home sale
listings are excluded. Perhaps even more troublesome, the listers who
are on Craigslist sometimes claim neighborhoods strategically in order
to increase the desirability of their listing.




For our currently purpose of understanding this modeling
\emph{approach}, we can ignore these difficulties. In a future work,
when we use these models to make claims about how neighborhoods work,
we will take up this issue again.



In addition to these data about neighborhood perception, we also have
block level census data as well as a trove of unaggregated data from
the City of Chicago on the built environment, crimes, 311 reports,
zoning, and the similar. We'd like to set them in relation to each
other.

\section*{Data Details}
The ultimate units of measurement are U.S. Census blocks and the edges
between them. The U.S. Census blocks mainly correspond to city face blocks.
We use a rook adjacency to define the edges, i.e. all edges are between blocks
that share a common border of length greater than 0. In the training data,
there are 5,857 blocks and
  13,887 edges.

For the inter-block similarities, we will use physical, demographic, and
administrative features (Table \ref{tab:Distribution}).

\subsection*{Physical Barriers}
Highways, rail lines, rivers, and major streets often act as neighborhood
boundaries. For each of these types of features, we code an edge feature
variable as 1 if the two adjacent blocks are separated by the feature or code
and 0 otherwise.

We also measure the difference in orientation between blocks. Blocks
are nearly all longer than they are wide, and we calculate the angle
of the longest side. For each pair of blocks, we calculate the
difference between the orientations of the blocks. We normalize the
difference to fall in $[0, 1]$. This measure was inspired by Vivien
Palmer's work on the persistent effect of primary settlements. 

In the late 1920s, Palmer argued that when a subdivision
of a city was originally opened for residential settlement, the
area would start out largely homogenous in its building stock
and population. This homogeneity would lead to the subdivision
maintaining a common fate through the history of the city. The
residents would tend to respond similarly to larger urban processes
and the building stock would tend to have the same patterns of
depreciation and reevaluation. The primary settlement should act as
atomic, spatial unit for urban processes.\cite{palmer_primary_1932}

When subdivision were originally laid out, the developers tended to
align the streets within their subdivision. Misalignment of blocks are
a rough measure of the where different subdivision meet. 

\subsection*{School Boundaries}
If two adjacent blocks are in different elementary school attendance boundary
then we code an edge feature with 1, 0 otherwise. Similar for high schools.

\subsection*{Demographic Features}
From the U.S. Census, we have block level information on race, age, family
structure, and housing ownership patterns. We can define measures between
blocks for these data.

We will use two measures for the demographic factors. The first is the
absolute difference. The second is the $\chi$ distance $\sqrt{
\frac{1}{2} \sum_i^d \frac{(x_i - y_i)^2}{x_i + y_i}}$, where $x_i$ is
the frequency of bin $i$ of the histogram $\mathbf{x}$ and similar for
$y_i$. This is just the square root of the familiar $\chi^2$ statistic. By
taking the square root, $\chi$ becomes a metric.\cite{pele_distance_2011}

For race, the distribution is the number people coded by the Census as
``Hispanic or Latino'', ``Not Hispanic or Latino : White alone'', ``Not Hispanic
or Latino : Black Alone'', and ``Not Hispanic or Latino : Asian alone.''

For age, we'll use the absolute difference between the log median age of
neighboring blocks.

For family structure, the distribution is of households with children
versus households without. 

For housing structure, the distribution is of housing units in the
rental market, housing market, or otherwise disposed. We also use the
absolute difference between the log median density of housing units.

Many blocks have no one living in them or only a handful. In such
cases, it makes little sense to compare demographic distributions. If
either adjacent blocks has fewer than 30 persons living in it, we do
not calculate the demographic differences. There are
7,092 edges where we calculate these
demographic similarities.

% latex table generated in R 3.0.1 by xtable 1.7-1 package
% Thu Mar 27 16:29:30 2014
\begin{table}[ht]
\centering
\begin{tabular}{rrrrrrr}
  \hline
 & Mean & Min & 25th Quant. & Median & 75th Quant. & Max \\ 
  \hline
Sufficient Population & 0.51 &  &  &  &  &  \\ 
  Rail & 0.01 &  &  &  &  &  \\ 
  Highway & 0.02 &  &  &  &  &  \\ 
  Water & 0.01 &  &  &  &  &  \\ 
  Elementary School & 0.13 &  &  &  &  &  \\ 
  High School & 0.03 &  &  &  &  &  \\ 
  Grid Street & 0.22 &  &  &  &  &  \\ 
  Block Angle & 0.20 & 0.00 & 0.00 & 0.00 & 0.50 & 1.00 \\ 
  Log Housing Density & 0.51 & 0.00 & 0.16 & 0.36 & 0.70 & 4.00 \\ 
  Log Median Age & 0.14 & 0.00 & 0.04 & 0.09 & 0.17 & 1.55 \\ 
  Ethnicity & 0.24 & 0.01 & 0.16 & 0.22 & 0.30 & 0.94 \\ 
  Housing & 0.23 & 0.00 & 0.12 & 0.19 & 0.31 & 0.93 \\ 
  Family & 0.13 & 0.00 & 0.05 & 0.11 & 0.19 & 0.81 \\ 
   \hline
\end{tabular}
\caption{Distribution of Barriers and Distances} 
\label{tab:Distribution}
\end{table}



\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/railImage} 

}



\end{knitrout}

\caption{Rail Lines}
\end{figure}

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/highwayImage} 

}



\end{knitrout}

\caption{Highways}
\end{figure}

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/gridImage} 

}



\end{knitrout}

\caption{Major Streets}
\end{figure}

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/waterImage} 

}



\end{knitrout}

\caption{River}
\end{figure}

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/elementaryImage} 

}



\end{knitrout}

\caption{Elementary School Attendance Boundaries}
\end{figure}

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/highschoolImage} 

}



\end{knitrout}

\caption{High School Attendance Boundaries}
\end{figure}

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/sufficientImage} 

}



\end{knitrout}

\caption{Sufficient Population}
\end{figure}


\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/blockAngleImage} 

}



\end{knitrout}

\caption{Difference in Block Orientation}
\end{figure}

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/_raceImage} 

}



\end{knitrout}

\caption{Difference in Distribution of Race and Ethnicity}
\end{figure}


\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/_ageImage} 

}



\end{knitrout}

\caption{Difference in Log Median Age}
\end{figure}


\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/_housingDiffImage} 

}



\end{knitrout}

\caption{Difference in Log Density of Housing Units}
\end{figure}


\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/_familyImage} 

}



\end{knitrout}

\caption{Difference in Distribution of Family Type}
\end{figure}


\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/_housingImage} 

}



\end{knitrout}

\caption{Difference in Distribution of Housing Type}
\end{figure}

\section*{Modeling}
Since many census blocks are empty, the demographic similarity between
these blocks is not well defined. We might be tempted to ignore these
cases, but deleting these cases would change the topology of the
city. Removing unpopulated blocks would turn populated blocks into
islands separated by commercial corridors. This would not allow for a
neighborhood to span a highway or industrial corridor, a possibility
we do not want to preclude.

We deal with this variation by using dummy variables to effectively
learn two model at once: a nonpopulated and populated block model.

Our overall scoring function is 
\begin{align}
&\operatorname{E}(\mathbf{y}, \mathbf{s}, \mathbf{w}) = \sum_{<i
    j>}^{\mathcal{N}}\epsilon_{i,j}(y_i, y_j, \mathbf{s}_{i,j}, \mathbf{w})  
\end{align}

where 
\begin{equation}
\epsilon_{i,j}(y_i, y_j, \mathbf{s}_{i,j}, \mathbf{w}) = \begin{cases}
    0 &y_i = y_j \\
    \phi(\mathbf{s}_{i,j}, \mathbf{w}) &y_i \neq y_j \\
  \end{cases}
\end{equation}

and the unpopulated block model is 
\begin{align}
\phi(\mathbf{s}_{i,j}, \mathbf{w}) = & w_0 
                                     + w_1\text{Rail}_{i,j} 
                                     + w_2\text{Water}_{i,j} 
                                     + w_3\text{Highway}_{i,j} \\
                                     &+ w_4\text{Major Street}_{i,j} 
                                     + w_5\text{Elementary School}_{i,j}\\ 
                                     & + w_6\text{High School}_{i,j}
                                     + w_7\text{Block Angle}_{i,j} \\
\end{align}

While the model for the populated neighboring blocks will be

\begin{align}
\phi(\mathbf{s}_{i,j}, \mathbf{w}) = & w_8 
                                     + w_9\text{Rail}_{i,j} 
                                     + w_{10}\text{Water}_{i,j} 
                                     + w_{11}\text{Highway}_{i,j}\\
                                     &+ w_{12}\text{Major Street}_{i,j} 
                                     + w_{13}\text{Elementary School}_{i,j}\\
                                     &+ w_{14}\text{High School}_{i,j} 
                                     + w_{15}\text{Block Angle}_{i,j}\\
                                     &+ w_{16}\text{Family Structure}_{i,j}
                                     + w_{17}\text{Race and Ethnicity}_{i,j}\\
                                     &+ w_{18}\text{Age Structure}_{i,j}  
                                     + w_{19}\text{Housing Structure}_{i,j} \\
                                     &+ w_{20}\text{Housing Density}_{i,j}  
\end{align}

We can combine these models by creating a dummy variable that takes a
value of 1 if neighboring blocks have sufficient population to support
the demographic distance measures, and 0 if the neighboring blocks do
not. We'll interact this dummy with the populated model and add the
variables to our unpopulated model.\footnote{Actually, our model is
  a little more complicated because we are not just comparing
  groups of people, but also groups of households and groups of
  housing units. Sometimes there is sufficient population to compare
  race, but not sufficient households to compare family structure. We
  use an additional dummy variables to handle these cases}

\begin{align}
\phi(\mathbf{s}_{i,j}, \mathbf{w}) =  & w_0 
                                     + w_1\text{Rail}_{i,j} 
                                     + w_2\text{Water}_{i,j} 
                                     + w_3\text{Highway}_{i,j} \\
                                     &+ w_4\text{Major Street}_{i,j} 
                                     + w_5\text{Elementary School}_{i,j}\\ 
                                     & + w_6\text{High School}_{i,j}
                                     + w_7\text{Block Angle}_{i,j} \\
                                     &+ \text{Populated Blocks}_{i,j}\cdot\\
                                     &\quad (w_8
                                     + w_{9}\text{Rail}_{i,j} 
                                     + w_{10}\text{Water}_{i,j}\\ 
                                     &\quad+ w_{11}\text{Highway}_{i,j}
                                     + w_{12}\text{Major Street}_{i,j}\\ 
                                     &\quad + w_{13}\text{Elementary School}_{i,j} 
                                     + w_{14}\text{High School}_{i,j}\\ 
                                     &\quad + w_{15}\text{Block Angle}_{i,j}
                                     + w_{16}\text{Family Structure}_{i,j}\\
                                     &\quad + w_{17}\text{Race and Ethnicity}_{i,j}
                                     + w_{18}\text{Age Structure}_{i,j}\\  
                                     &\quad+ w_{19}\text{Housing Structure}_{i,j}
                                     + w_{20}\text{Housing Density}_{i,j})\\
\end{align}


\section*{Results}
After training the model using the PyStruct structure learning
framework,\cite{mueller_pystruct:_2014} we get two classes of results:
predictions of Chicago neighborhoods and parameter
estimates.\footnote{See \url{https://github.com/fgregg/pystruct} for
  custom model} Given a set of learned weights we can find,
approximately, a lowest scoring assignment of labels to neighborhoods
of the city.\footnote{However, some care must be taken to not immediately
assign meaning to these labelings. Two blocks that have been assigned that
same label do not necessarily belong to the same neighborhood. The
labelings are only locally meaningful in that they distinguish a
particular neighborhood from it’s neighbors. Instead, a neighborhood
will be a set of blocks that have the same label and which are
connected components.}

Let’s start by looking at predictions for our training blocks to
highlight some characteristics of our model (Figure
\ref{fig:predictTraining}).

\begin{figure}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}

{\centering \includegraphics[width=\maxwidth]{/home/fgregg/sweave-cache/figs/plotPredictions} 

}



\end{knitrout}

\caption{Predicted Neighborhoods}
\label{fig:predictTraining}
\end{figure}




First, our model depends upon C, the normalizer. We choose C by
estimating the model for various values of C between 1.0 and 0.0001
and choosing the value that maximizes the fit between the predicted
neighborhoods and the training neighborhoods. The value of C that gave
the best fit was 0.0005.

Second, our model predicts many, very small neighborhoods. In Figure
\ref{fig:predictTraining}, I have colored the


{\ttfamily\noindent\bfseries\color{errorcolor}{\\Error in eval(expr, envir, enclos) : object 'hood\_frequency' not found}} neighborhoods that have ten or more
blocks and grayed out the 

{\ttfamily\noindent\bfseries\color{errorcolor}{\\Error in eval(expr, envir, enclos) : object 'hood\_frequency' not found}} remaining,
small neighborhoods. There are 

{\ttfamily\noindent\bfseries\color{errorcolor}{\\Error in eval(expr, envir, enclos) : object 'hood\_frequency' not found}}
neighborhoods that consist of a single block.

Third, our model seems to do an adequate job in capturing
neighborhoods. We have a Rand Index score of 0.93 and an
Adjusted Rand of 0.33.

Now, turning to the parameters, we'll focus on the parameters for the
populated blocks (Table \ref{tab:parameters}). A positive parameter
means that, all else equal, the total score will be lower if adjacent
blocks are allocated to separate neighborhoods. Negative parameters,
means that all else equal, adjacent blocks should be allocated to the
same neighborhood. So, for example the negative intercepts mean that
adjacent blocks that are identical will ‘prefer’ to be assigned to the
same neighborhood.

Nearly all parameters for barriers and administrative zones have a
positive sign, which is what we expect: dissimilar blocks and blocks
separated by barriers are more apt to be placed in separate
neighborhoods. The negative `attractive' parameter for major street is
likely due to fact that every one of our training neighborhoods
contains multiple major grid streets.

The demographic distances are more complicated. Differences in ethnic
and racial composition is strongly positive. Such a `divisive'
parameter is required to have face validity in Chicago. Differences in
the density of housing units also has the expected sign. Differences
in median age and housing structure are unexpectedly weak, but also
very close to 0. The relatively strong `attractive' parameter for
differences in family structure is very surprising. According the this
model, a block that is all families and a block that has no families
are very apt to belong the same neighborhood. 

% latex table generated in R 3.0.1 by xtable 1.7-1 package
% Tue Aug 19 12:43:25 2014
\begin{table}[ht]
\centering
\begin{tabular}{rr}
  \hline
 &  \\ 
  \hline
(Intercept) & -0.0026 \\ 
  Railroad & 0.0104 \\ 
  Water & 0.0029 \\ 
  Highway & 0.0064 \\ 
  Major Street & -0.0021 \\ 
  Elementary School & 0.0005 \\ 
  High School & 0.0043 \\ 
  Block Angle & 0.0021 \\ 
  Family Structure & -0.0021 \\ 
  Race and Ethnicity & 0.0040 \\ 
  Age Structure & -0.0008 \\ 
  Density of Housing Units & 0.0037 \\ 
  Housing Structure & -0.0004 \\ 
   \hline
\end{tabular}
\caption{Parameter Estimates for Populated Blocks} 
\label{tab:parameters}
\end{table}



\section*{Discussion}
While these results of modeling neighborhoods are interesting, we
should take care to not put too much weight in them yet. Our purpose
in this paper is to explore an \emph{approach} to modeling
neighborhoods, and figuring out what counts block-by-block for making
a neighborhood.

What we have established is that this model of neighborhoods seems to
be able to predict, with some fidelity, the training data, and that
the parameter values comport with our previous expectations. These
results should give us confidence that the modeling approach can
capture this thing, the neighborhood, that we are trying to grasp.

However, in order to learn from the model or extrapolate 
predictions beyond the training data, this approach must pass much
more rigorous tests than simply predicting the training data for one
city. In a future paper, I will use this approach to model
neighborhoods in the fifty largest American urban areas, and evaluate
the predictive power of this conception of neighborhoods. 

In future work, we could use the same types of models to learn about
the structures of intra-party factions through looking at campaign
giving or social class-like structure by looking at marriage
patterns. Much of this work will depend upon being able to validly
distinguish between proximity and similarity. In cities, its easy to
do this. In other areas of social research, it's not so simple to
distinguish between the two.

\newpage
\begingroup
\parindent 0pt
\parskip 2ex
\def\enotesize{\normalsize}
\theendnotes
\endgroup

\newpage
\bibliographystyle{asr}
\bibliography{qp}

\begin{figure}
\includegraphics{../code/training/predicted_chicago_neighborhoods.pdf}
\caption{Predicted Neighborhoods in Chicago}
\end{figure}


\end{document}
